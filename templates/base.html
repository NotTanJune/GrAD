<!doctype html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Grab a Degree</title>

  <!-- Set theme before paint -->
  <script>
    (function () {
      const saved = localStorage.getItem("theme");
      const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
      const isDark = saved ? saved === "dark" : prefersDark;
      if (isDark) document.documentElement.classList.add("dark");
    })();
  </script>

  <!-- HTMX + _hyperscript + Alpine.js -->
  <script src="https://unpkg.com/htmx.org@1.9.12"></script>
  <script src="https://unpkg.com/hyperscript.org@0.9.12"></script>
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>

  <!-- jQuery + jQuery UI (Sortable) -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://code.jquery.com/ui/1.13.3/jquery-ui.min.js"></script>

  <!-- Tailwind (with forms + typography plugins) -->
  <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        container: { center: true, padding: '1rem' },
        extend: {
          colors: { brand: { 50:'#eef2ff', 100:'#e0e7ff', 500:'#6366f1', 600:'#4f46e5' } },
          boxShadow: { soft: '0 8px 30px rgba(2,6,23,.08)' }
        }
      }
    }
  </script>

  <!-- App component layer -->
  <style type="text/tailwindcss">
    @layer components {
      .card { @apply bg-white/80 dark:bg-slate-900/80 backdrop-blur-xl ring-1 ring-black/5 dark:ring-white/10 rounded-2xl shadow-soft border border-slate-200/50 dark:border-slate-700/50; }
      .btn { @apply inline-flex items-center gap-2 rounded-xl px-4 py-2 text-sm font-medium transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-40 disabled:cursor-not-allowed; }
      .btn-primary { @apply btn bg-gradient-to-r from-slate-900 to-slate-800 text-white hover:-translate-y-0.5 hover:shadow-lg active:translate-y-0 focus:ring-brand-500 dark:from-white dark:to-slate-100 dark:text-slate-900; }
      .btn-ghost { @apply btn border border-slate-300 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800 hover:border-slate-400 dark:hover:border-slate-600; }
      .nav-link { @apply text-sm text-slate-800/80 dark:text-slate-200/80 hover:text-slate-900 dark:hover:text-white transition-colors duration-200; }
      .badge { @apply inline-flex items-center rounded-full bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 px-2.5 py-1 text-xs font-medium; }
    }
  </style>

  <!-- Drag visuals (only the few we need) -->
  <style>
    /* Floating helper (clone) that follows the cursor */
    .ui-sortable-helper {
      position: fixed !important;
      pointer-events: none;
      transform: translateZ(0);
      z-index: 9999;
      margin: 0 !important;
    }

    /* Drag wrapper styling */
    .drag-wrapper {
      background: transparent;
      border-radius: 8px;
      overflow: hidden;
    }

    /* Placeholder: thin dashed guide line that spans the row */
    .ui-sortable-placeholder { 
      visibility: visible !important; 
      background: transparent !important; 
    }
    .ui-sortable-placeholder > td {
      padding: 8px 0 !important;
      border-top: 2px dashed rgba(100,116,139,.35);
      border-bottom: 0 !important;
      height: 0 !important; 
      line-height: 0 !important;
    }

    /* Smooth sibling motion + no text selection during drag */
    #apps-table tr { 
      transition: transform .2s cubic-bezier(.2,.8,.2,1), background-color .12s; 
    }
    #apps-table, #apps-table * { 
      user-select: none; 
    }

    .drag-handle { 
      cursor: grab; 
    }
    .drag-handle:active { 
      cursor: grabbing; 
    }

    /* Better visual feedback during drag */
    .ui-sortable-helper .drag-handle {
      opacity: 0.4;
    }
  </style>
</head>

<body class="bg-slate-50 text-slate-800 dark:bg-slate-950 dark:text-slate-100">
  <!-- Top gradient nav -->
  <header class="sticky top-0 z-30">
    <div class="bg-gradient-to-r from-violet-600 via-indigo-600 to-cyan-500 shadow-lg">
      <nav class="container">
        <div class="py-4 flex items-center gap-6 flex-wrap md:flex-nowrap text-white">
          <!-- Brand: far left -->
          <a href="/" class="flex items-center gap-2 font-bold text-2xl tracking-tight hover:scale-105 transition-transform">
            <span class="sr-only">Grab a Degree</span>
            <span class="font-black leading-none">GrAD</span>
          </a>

          <!-- Left-aligned nav with padding from logo (only when logged in) -->
          <div class="flex-1 min-w-0">
            {% if user.is_authenticated %}
            <ul class="flex items-center gap-8 pl-6">
              <li>
                <a href="/applications/new/" class="nav-link text-white/90 hover:text-white font-medium">New Application</a>
              </li>
              <li>
                <a href="/applications/sop-assistant/" class="nav-link text-white/90 hover:text-white font-medium">SOP Assistant</a>
              </li>
            </ul>
            {% endif %}
          </div>

          <!-- Right controls -->
          <div class="ml-auto flex items-center gap-3 shrink-0">
            <button id="themeToggle" class="btn-ghost bg-white/10 text-white hover:bg-white/20 transition-all duration-200" title="Toggle dark mode">
              <svg id="sun" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden dark:inline" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <circle cx="12" cy="12" r="5"></circle>
                <line x1="12" y1="1" x2="12" y2="3"></line>
                <line x1="12" y1="21" x2="12" y2="23"></line>
                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                <line x1="1" y1="12" x2="3" y2="12"></line>
                <line x1="21" y1="12" x2="23" y2="12"></line>
                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
              </svg>
              <svg id="moon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 dark:hidden" viewBox="0 0 24 24" fill="currentColor"><path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 1 0 9.79 9.79Z"/></svg>
            </button>

            {% if user.is_authenticated %}
              <form action="/accounts/logout/" method="post" class="inline">
                {% csrf_token %}
                <button class="btn-ghost bg-white/10 text-white hover:bg-white/20 font-medium transition-all duration-200">Logout</button>
              </form>
            {% else %}
              <a href="/accounts/login/" class="btn-ghost bg-white/10 text-white hover:bg-white/20 font-medium transition-all duration-200">Log in</a>
            {% endif %}
          </div>
        </div>
      </nav>
    </div>
  </header>

  <main class="container pt-6 pb-12">
    {% if messages %}
      <div class="space-y-2 mb-4">
        {% for m in messages %}
          <div class="card px-4 py-3 text-sm border border-emerald-200/60 dark:border-emerald-900/40
                      bg-emerald-50/70 dark:bg-emerald-900/20 text-emerald-800 dark:text-emerald-200">
            {{ m }}
          </div>
        {% endfor %}
      </div>
    {% endif %}
    {% block content %}{% endblock %}
  </main>

  <footer class="container pb-10 text-xs text-slate-500 dark:text-slate-400 text-center">
    <div class="mt-2">Built for Emergency GPT Hackathon 2025</div>
  </footer>

  <!-- Simple confirm modal -->
  <div id="confirmModal" class="fixed inset-0 hidden flex items-center justify-center bg-black/50 z-[10000]">
    <div class="bg-white dark:bg-slate-900 w-full max-w-md rounded-2xl p-5 shadow-xl ring-1 ring-black/10 dark:ring-white/10">
      <h3 class="text-lg font-semibold mb-2 text-slate-900 dark:text-slate-100">Confirm deletion</h3>
      <p class="text-sm text-slate-600 dark:text-slate-300">Are you sure you want to delete this application?</p>
      <div class="mt-5 flex justify-end gap-2">
        <button id="btnCancelDel" class="btn-ghost">Cancel</button>
        <button id="btnConfirmDel" class="btn-primary">Confirm Deletion</button>
      </div>
    </div>
  </div>

  <script>
    document.getElementById('themeToggle')?.addEventListener('click', () => {
      const root = document.documentElement;
      const toDark = !root.classList.contains('dark');
      root.classList.toggle('dark', toDark);
      localStorage.setItem('theme', toDark ? 'dark' : 'light');
    });

    function confirmDeleteApplication(formEl) {
      const modal = document.getElementById('confirmModal');
      const okBtn = document.getElementById('btnConfirmDel');
      const cancelBtn = document.getElementById('btnCancelDel');
      if (!modal || !okBtn || !cancelBtn) return false;

      const cleanup = () => {
        modal.classList.add('hidden');
        okBtn.removeEventListener('click', onOk);
        cancelBtn.removeEventListener('click', onCancel);
      };
      const onOk = () => { cleanup(); formEl.submit(); };
      const onCancel = () => { cleanup(); };
      okBtn.addEventListener('click', onOk);
      cancelBtn.addEventListener('click', onCancel);
      modal.classList.remove('hidden');

      // prevent immediate submission; we will submit on confirm
      return false;
    }
    window.confirmDeleteApplication = confirmDeleteApplication;
  </script>
</body>
</html>