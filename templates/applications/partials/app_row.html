{# templates/applications/partials/app_row.html #}
<tr class="hover:bg-slate-50/80 dark:hover:bg-slate-800/40 transition-colors duration-200" data-id="{{ app.id|add:0 }}">
  <!-- Drag handle -->
  <td class="px-4 py-4 cursor-grab drag-handle select-none text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 transition-colors" title="Drag to reorder">
    <div class="flex items-center justify-center h-full">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor">
        <path d="M10 6a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm6 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0ZM10 12a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm6 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0ZM10 18a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm6 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/>
      </svg>
    </div>
  </td>

  <!-- College / Program -->
  <td class="px-4 py-4 align-middle">
    <div class="font-semibold text-slate-900 dark:text-slate-100">{{ app.college_name|default:"(College)" }}</div>
    <div class="text-sm text-slate-500 dark:text-slate-400 mt-0.5">{{ app.program_name|default:"(Program)" }}</div>
  </td>

  <!-- Priority -->
  <td class="text-center align-middle px-4" data-cell="priority">
    <span class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-slate-100 dark:bg-slate-800 text-sm font-semibold text-slate-700 dark:text-slate-300">
      {{ app.priority }}
    </span>
  </td>

  <!-- Status (modern dropdown) -->
  <td class="align-middle px-4">
    <div class="relative" x-data="{ open: false }">
      {# Current status button #}
      <button type="button" 
              @click="open = !open"
              class="status-button inline-flex items-center gap-2 rounded-lg px-3 py-1.5 text-sm font-medium transition-all duration-200 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2
                     {% if app.status in 'accepted,admit,offer' %}
                       bg-emerald-100 text-emerald-800 dark:bg-emerald-900/40 dark:text-emerald-200 hover:bg-emerald-200 dark:hover:bg-emerald-900/60 focus:ring-emerald-500
                     {% elif app.status in 'rejected,denied' %}
                       bg-red-100 text-red-800 dark:bg-red-900/40 dark:text-red-200 hover:bg-red-200 dark:hover:bg-red-900/60 focus:ring-red-500
                     {% elif app.status == 'submitted' %}
                       bg-orange-100 text-orange-800 dark:bg-orange-900/40 dark:text-orange-200 hover:bg-orange-200 dark:hover:bg-orange-900/60 focus:ring-orange-500
                     {% elif app.status == 'interview' %}
                       bg-blue-100 text-blue-800 dark:bg-blue-900/40 dark:text-blue-200 hover:bg-blue-200 dark:hover:bg-blue-900/60 focus:ring-blue-500
                     {% elif app.status in 'review,under_review' %}
                       bg-yellow-100 text-yellow-800 dark:bg-yellow-900/40 dark:text-yellow-200 hover:bg-yellow-200 dark:hover:bg-yellow-900/60 focus:ring-yellow-500
                     {% elif app.status == 'waitlist' or app.status == 'waitlisted' %}
                       bg-purple-100 text-purple-800 dark:bg-purple-900/40 dark:text-purple-200 hover:bg-purple-200 dark:hover:bg-purple-900/60 focus:ring-purple-500
                     {% elif app.status == 'draft' %}
                       bg-slate-100 text-slate-700 dark:bg-slate-800/60 dark:text-slate-200 hover:bg-slate-200 dark:hover:bg-slate-700/60 focus:ring-slate-500
                     {% else %}
                       bg-slate-100 text-slate-700 dark:bg-slate-800/40 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700/60 focus:ring-slate-500
                     {% endif %}">
        <span>{{ app.get_status_display|default:app.status }}</span>
        <svg class="h-4 w-4 transition-transform duration-200" :class="{ 'rotate-180': open }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
        </svg>
      </button>

      {# Dropdown menu #}
      <div x-show="open" 
           x-transition:enter="transition ease-out duration-200"
           x-transition:enter-start="opacity-0 scale-95"
           x-transition:enter-end="opacity-100 scale-100"
           x-transition:leave="transition ease-in duration-150"
           x-transition:leave-start="opacity-100 scale-100"
           x-transition:leave-end="opacity-0 scale-95"
           @click.away="open = false"
           class="absolute top-full left-0 mt-1 w-48 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-lg ring-1 ring-black/5 dark:ring-white/10 z-[9999] max-h-60 overflow-y-auto">
        <div class="py-1">
          {% for val, label in status_choices %}
            {% with v=val|lower %}
            <button type="button" 
                    @click="open = false; updateStatus('{{ v }}')"
                    class="w-full text-left px-3 py-2 text-sm transition-colors duration-150
                           {% if app.status == v %}
                             bg-slate-100 dark:bg-slate-700 text-slate-900 dark:text-slate-100
                           {% else %}
                             text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700/50
                           {% endif %}
                           {% if v in 'accepted,admit,offer' %}
                             border-l-4 border-emerald-500
                           {% elif v in 'rejected,denied' %}
                             border-l-4 border-red-500
                           {% elif v == 'submitted' %}
                             border-l-4 border-orange-500
                           {% elif v == 'interview' %}
                             border-l-4 border-blue-500
                           {% elif v in 'review,under_review' %}
                             border-l-4 border-yellow-500
                           {% elif v == 'waitlist' or v == 'waitlisted' %}
                             border-l-4 border-purple-500
                           {% elif v == 'draft' %}
                             border-l-4 border-slate-500
                           {% else %}
                             border-l-4 border-slate-400
                           {% endif %}">
              {{ label }}
            </button>
            {% endwith %}
          {% endfor %}
        </div>
      </div>
    </div>
  </td>

  <!-- Updated -->
  <td class="text-sm text-slate-600 dark:text-slate-400 align-middle px-4 whitespace-nowrap">
    {{ app.last_updated }}
  </td>

  <!-- Actions -->
  <td class="text-right align-middle px-4">
    <form method="post"
          action="{% url 'applications:application_delete' app.pk %}"
          hx-post="{% url 'applications:application_delete' app.pk %}"
          hx-target="closest tr"
          hx-swap="outerHTML"
          onsubmit="return confirmDeleteApplication(this);"
          class="inline-block">
      {% csrf_token %}
      <input type="hidden" name="confirm_key" value="">
      <button type="submit"
              class="inline-flex items-center gap-2 rounded-lg px-3 py-1.5 text-sm font-medium transition-all duration-200 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 text-red-600 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 hover:bg-red-100 dark:hover:bg-red-900/40 focus:ring-red-500">
        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
        </svg>
        Delete
      </button>
    </form>
  </td>
</tr>